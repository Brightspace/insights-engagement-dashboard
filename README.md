# d2l-insights-engagement-dashboard

[![Build Status](https://travis-ci.com/Brightspace/insights-engagement-dashboard.svg?branch=master)](https://travis-ci.com/Brightspace/insights-engagement-dashboard)
[![Dependabot badge](https://flat.badgen.net/dependabot/Brightspace/insights-engagement-dashboard?icon=dependabot)](https://app.dependabot.com/)

> Note: this is a ["labs" component](https://github.com/BrightspaceUI/guide/wiki/Component-Tiers). While functional, these tasks are prerequisites to promotion to BrightspaceUI "official" status:
>
> - [ ] [Design organization buy-in](https://github.com/BrightspaceUI/guide/wiki/Before-you-build#working-with-design)
> - [ ] [design.d2l entry](http://design.d2l/)
> - [ ] [Architectural sign-off](https://github.com/BrightspaceUI/guide/wiki/Before-you-build#web-component-architecture)
> - [ ] [Continuous integration](https://github.com/BrightspaceUI/guide/wiki/Testing#testing-continuously-with-travis-ci)
> - [ ] [Cross-browser testing](https://github.com/BrightspaceUI/guide/wiki/Testing#cross-browser-testing-with-sauce-labs)
> - [ ] [Unit tests](https://github.com/BrightspaceUI/guide/wiki/Testing#testing-with-polymer-test) (if applicable)
> - [ ] [Accessibility tests](https://github.com/BrightspaceUI/guide/wiki/Testing#automated-accessibility-testing-with-axe)
> - [ ] [Visual diff tests](https://github.com/BrightspaceUI/visual-diff)
> - [ ] [Localization](https://github.com/BrightspaceUI/guide/wiki/Localization) with Serge (if applicable)
> - [ ] Demo page
> - [ ] README documentation

D2L Insights Engagement Dashboard

## Usage

```html
<script type="module">
    import '@brightspace/d2l-engagement-dashboard/engagement-dashboard.js';
</script>
<d2l-insights-engagement-dashboard>My element</d2l-insights-engagement-dashboard>
```

**Properties:**

| Property | Type | Description |
|--|--|--|
| | | |

**Accessibility:**

To make your usage of `d2l-insights-engagement-dashboard` accessible, use the following properties when applicable:

| Attribute | Description |
|--|--|
| | |

## Developing, Testing and Contributing

After cloning the repo, run `npm install` to install dependencies.

#### Releasing and Versioning

To make a release, update the version number in package.json and
make a release in github. BSI and LMS changes will be handled by
automation (master branch only: release branches of the LMS
have to be handled manually).

This repo uses the following versioning scheme for both package.json
and release tags:
- major: always 1, so BSI automatically picks up every update
- minor: the minor and patch LMS version with zero-padding; e.g. 2012 for 2020 December, 2101 for the January release, etc.
- patch: increment as needed

### Running the demos

To start an [es-dev-server](https://open-wc.org/developing/es-dev-server.html) that hosts the demo page and tests:

```shell
npm start
```

### Linting

```shell
# eslint and lit-analyzer
npm run lint

# eslint only
npm run lint:eslint

# lit-analyzer only
npm run lint:lit
```

### Testing

```shell
# lint, unit test and visual-diff test
npm test

# lint only
npm run lint

# unit tests only
npm run test:headless

# debug or run a subset of local unit tests
# then navigate to `http://localhost:9876/debug.html`
npm run test:headless:watch
```

#### Note on Sauce Labs tests

Pull requests run cross-browser tests using Sauce. For troubleshooting,
see https://wiki.saucelabs.com/pages/viewpage.action?pageId=70072943.

### Visual Diff Testing

This repo uses the [@brightspace-ui/visual-diff utility](https://github.com/BrightspaceUI/visual-diff/) to compare current snapshots against a set of golden snapshots stored in source control.

The visual diff action uses aws secrets that are generated in the [iam-build-tokens repo](https://github.com/Brightspace/iam-build-tokens/blob/master/terraform/roles/insights-dashboards.tf)

```shell
# run visual-diff tests
npm run test:diff

# subset of visual-diff tests:
npm run test:diff -- -g some-pattern

# update visual-diff goldens
npm run test:diff:golden
```

A useful way to debug visual tests is to check the report that is created when the tests fail.

Golden snapshots generated locally will not replace the ones generated by the CI Action. Goldens generated by the CI action are stored in ./test/visual-diff/screenshots/ci/goldens. Locally created goldens will appear in ./test/visual-diff/screenshots and are ignored by git. The goldens generated by the ci are not ignored as they are used by the action for diffing.

If the action fails you can view the diff report by
1. Opening the failed visual test action in your PR (Not the bots PR)
2. Find the failed test in the action window
3. Click on the `Result:` link (should be soemthing like visual-diff.d2l.dev/)

When the action fails the github bot will open a pr with new snapshots. Merging this PR into your branch will replace the goldens with the snapshots from the previouse vs diff test. Use the steps above to evaluate the differences and if you want them to become the new goldens
1. Merge the bots PR into your PR
2. Merging will trigger another visual diff test which, hopefully, will pass now that it is using the new goldens.

Note: Place all visual tests in the ./test/visual-diff folder or they will be ignored by the Github Action.

To run diff tests locally

```
# for powershell
$Env:GITHUB_REPOSITORY=Brightspace/insights-engagement-dashboard

# for bash
export GITHUB_REPOSITORY=Brightspace/insights-engagement-dashboard


npm run test:diff:golden
# make some changes
npm run test:diff
```

Once finished you can find the report in ./test/visual-diff/screenshots/current/\<test-name\>/report.html, VSCode users can use an html previewer extension for quick debugging.
## Versioning, Releasing & Deploying

All version changes should obey [semantic versioning](https://semver.org/) rules.

Include either `[increment major]`, `[increment minor]` or `[increment patch]` in your merge commit message to automatically increment the `package.json` version and create a tag.

## Telemetry

This app gathers performance and usage telemetry. You can find more details [here](https://desire2learn.atlassian.net/wiki/spaces/DRACO/pages/1697317280/Engagement+Dashboard+Telemetry)
